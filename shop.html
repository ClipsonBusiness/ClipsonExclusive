<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClipSon Exclusive Shop</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Trackdesk tracker begin -->
    <script async src="//cdn.trackdesk.com/tracking.js"></script> 
    <script>
    (function(t,d,k){(t[k]=t[k]||[]).push(d);t[d]=t[d]||t[k].f||function(){(t[d].q=t[d].q||[]).push(arguments)}})(window,"trackdesk","TrackdeskObject"); 
    
    trackdesk('clipson', 'click');
    </script>
    <!-- Trackdesk tracker end -->
    
    <!-- Clipson Affiliate Tracking -->
    <script>
    (function() {
      // Only run on the client's domain
      const hostname = window.location.hostname;
      const domainMatch = hostname === 'clipsonexclusive.com' || hostname === 'www.clipsonexclusive.com';
      if (!domainMatch) return;

      // Check for ?ref= parameter
      const urlParams = new URLSearchParams(window.location.search);
      const refParam = urlParams.get('ref');
      
      if (!refParam) return;

      // Set cookie on client's domain (90 days expiry)
      // This cookie will be available when user reaches Stripe checkout
      const expiryDays = 90;
      const expiryDate = new Date();
      expiryDate.setTime(expiryDate.getTime() + (expiryDays * 24 * 60 * 60 * 1000));
      document.cookie = 'ca_affiliate_id=' + encodeURIComponent(refParam) + 
        '; expires=' + expiryDate.toUTCString() + 
        '; path=/' + 
        '; SameSite=Lax' + 
        (location.protocol === 'https:' ? '; Secure' : '');

      // Log for debugging
      console.log('✅ Affiliate tracking: Cookie set', {
        affiliateId: refParam,
        cookie: 'ca_affiliate_id=' + encodeURIComponent(refParam)
      });

      // Optionally record click on tracking server (non-blocking)
      const beaconUrl = 'https://www.clipsonaffiliates.com/track?ref=' + encodeURIComponent(refParam) + '&beacon=true';
      if (navigator.sendBeacon) {
        try {
          navigator.sendBeacon(beaconUrl);
        } catch(e) {
          fetch(beaconUrl, { method: 'GET', keepalive: true, mode: 'no-cors' }).catch(() => {});
        }
      } else {
        fetch(beaconUrl, { method: 'GET', keepalive: true, mode: 'no-cors' }).catch(() => {});
      }
    })();
    </script>
</head>
<body>
    <header>
        <nav>
            <div class="logo"><a href="index.html"><img src="images/clipson-logo.png" alt="ClipSon Logo" class="logo-img"></a></div>
            <div class="nav-links">
                <a href="index.html#features" class="nav-link">Features</a>
                <a href="index.html#interviews" class="nav-link">Student Interviews</a>
                <a href="index.html#wins" class="nav-link">Student Wins</a>
                <a href="shop.html" class="nav-link">Shop</a>
            </div>
            <a href="https://buy.stripe.com/14A00kgCkh0IcQhg2D5gc02" class="cta-button" target="_blank" rel="noopener">Join ClipSon Exclusive</a>
        </nav>
    </header>
    <main>
        <section id="proxies" class="shop-section">
            <h2>Shop</h2>
            <div class="proxies-grid">
                <div class="proxy-card">
                    <h3>Proxy</h3>
                    <div class="proxy-options">
                        <label for="proxy-duration">Duration:</label>
                        <select id="proxy-duration" class="proxy-select">
                            <option value="1m">1 Month</option>
                            <option value="3m">3 Months</option>
                        </select>
                    </div>
                    <p class="proxy-price" id="proxy-price">$15/month</p>
                    <button class="buy-btn" id="proxy-buy-btn">Buy Now</button>
                </div>
                <div class="proxy-card">
                    <h3>Aged Instagram Page</h3>
                    <p class="proxy-price">$25</p>
                    <p class="proxy-subtext">Premium aged accounts with trials</p>
                    <button class="buy-btn" onclick="window.location.href='https://buy.stripe.com/8x228seucfWE5nP03F5gc09'">Buy Now</button>
                </div>
            </div>
        </section>
        <!-- Future: Add Aged Pages section here -->
    </main>
    <footer>
        <p>&copy; 2024 ClipSon Exclusive. All rights reserved.</p>
    </footer>
    <script>
    // Update proxy price and buy button link based on duration
    const durationSelect = document.getElementById('proxy-duration');
    const priceDisplay = document.getElementById('proxy-price');
    const buyBtn = document.getElementById('proxy-buy-btn');
    function updateProxyPrice() {
        if (durationSelect.value === '1m') {
            priceDisplay.textContent = '$15/month';
            buyBtn.onclick = function() { window.location.href = 'https://buy.stripe.com/3cI00kgCk4dW7vX2bN5gc04'; };
        } else {
            priceDisplay.textContent = '$25/3 months';
            buyBtn.onclick = function() { window.location.href = 'https://buy.stripe.com/cNi3cw0Dm5i09E5cQr5gc05'; };
        }
    }
    durationSelect.addEventListener('change', updateProxyPrice);
    // Initialize on load
    updateProxyPrice();
    </script>
    
    <!-- Trackdesk set client_reference_id help fuction begin -->
    <script>
    (function () {
        var cookie = document.cookie.match('(^|;)\\s*trakdesk_cid\\s*=\\s*([^;]+)');
        if (Array.isArray(cookie)) {
            try {
                var trakdeskCid = JSON.parse(cookie.pop());
                var cid = trakdeskCid['cid'];
                console.log('Trackdesk CID found:', cid);
                
                document.querySelectorAll('a[href^="https://buy.stripe.com/"]').forEach(function (a) {
                    var originalUrl = a.href;
                    var url = new URL(a.href);
                    url.searchParams.set('client_reference_id', cid);
                    a.href = url.href;
                    console.log('Payment link updated:', originalUrl, '→', a.href);
                });
            } catch (e) {
                console.log('Trackdesk error:', e);
            }
        } else {
            console.log('No Trackdesk CID cookie found');
        }
    })();
    </script>
    <!-- Trackdesk set client_reference_id help fuction end -->
</body>
</html>
